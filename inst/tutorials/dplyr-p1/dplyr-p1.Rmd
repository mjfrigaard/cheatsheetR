---
title: "Data transformation with dplyr (part 1)"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: default
    includes:
      in_header: resizer.html
runtime: shiny_prerendered
description: >
  Restructure and reshape data with tidyr.
---

```{r setup, include = FALSE}
library(learnr)
library(tidyverse)
library(googlesheets4)
library(skimr)
library(knitr)
library(readxl)
library(reactable)
library(writexl)
library(openxlsx)
library(datapasta)
library(gt)
library(flextable)
# pipe url: 
# https://bit.ly/01-file-txt 
# CSV url: 
# https://bit.ly/01-file-csv 
# CSV2 url: ----
# https://bit.ly/01-file2-csv 
# TSV url:
# https://bit.ly/01-file-tsv 
# f1.csv: 
# https://bit.ly/01-f1-csv 
# f2.csv: 
# https://bit.ly/01-f2-csv
# f3.csv: 
# https://bit.ly/01-f3-csv 
knitr::opts_chunk$set(
  upload.fun = imgur_upload, 
  error = TRUE,
  exercise.cap = "dplyr")
```

[Link to `dplyr` website](https://dplyr.tidyverse.org/)  
[Link to cheatsheets](https://www.rstudio.com/resources/cheatsheets/) 

## The cheatsheet (part 1)

```{r dplyr-p1.png, echo=FALSE, fig.align='center', out.height='100%', out.width='100%'}
knitr::include_graphics(path = "www/dplyr-p1.png")
```

<br>

***We've split the Data Transformation cheatsheet into two tutorials. This tutorial covers page 1 (summarize, group, manipulate).***

<br>

Below we install and load the packages:

<br>

```{r packages, eval=FALSE}
install.packages(c("dplyr", "tibble"))
library(dplyr)
library(tibble)
```

## Tidy data & Pipes

> "`dplyr` functions work with pipes and expect tidy data.*

There are three main tenets of tidy data:

1. Each column contains a single **variable**  
2. Each row contains a single **observation**  
3. **Values** are at the intersection of variables and observations  

```{r tidy-data, echo=FALSE, fig.align='center', out.height='65%', out.width='65%'}
knitr::include_graphics(path = "www/tidy-data.png")
```

We'll cover tidy data in more depth in the [`tidyr` tutorial](https://mjfrigaard.github.io/cheatsheetR/tutorials/tidyr-p1.html), but we recommend reading the [original paper by Hadley Wickham](https://doi.org/10.18637/jss.v059.i10). 

### Pipes 

```{r pipes, echo=FALSE, fig.align='center', out.height='45%', out.width='45%'}
knitr::include_graphics(path = "www/pipes.png")
```

Pipes are an example of [syntactic sugar](https://www.techopedia.com/definition/10212/syntactic-sugar#:~:text), which are "*syntax changes in computer programming which make it easier for humans to code.*" R is a functional programming language, so before the pipe we would write *nested* function calls. 

Imagine we want to apply a function (`first_function()`) to an object (`x`) which returns  `y` as the output, but then we want to apply a second function (`second_function()`) to `y`? Without pipes, we would have to assign the output from each function to it's own object:

```r
y <- first_function(x)
z <- second_function(y)
z
# [1] output
```

Or we would have to nest the function calls:

```r
second_function(first_function(x), y)
```

As you can see, the first option clutters up our working environment with intermediate values, and the second options forces us to read the function *from the inside out*. 

Pipes solve this problem by allowing us to 'pipe' the output from one function into subsequent functions:

```r
x %>% # original input
  first_function() %>% # output from first function
  second_function(y) # output from first and second functions
```

#### `%>%` or `|>`?

The cheatsheet examples use the pipe provided by the `magrittr` package, `%>%` (the `magrittr` pipe is imported as part of the `tidyverse`). As of 2021, R [version 4.1.0](https://stat.ethz.ch/pipermail/r-announce/2021/000670.html) (codename "Camp Pontanezen") was released with a native pipe (`|>`). We're going to demonstrate using both because of reasons [better explained elsewhere.](https://r4ds.hadley.nz/workflow-pipes.html#vs) The important thing to understand about pipes is how they restructure multiple function calls.

Use the code block below to experiment with pipes: 

```{r prepare-pipes, echo=FALSE}
x <- c(8.3, 3.14, 28.0001, 11.75)
```


```{r test-pipes, exercise=TRUE, exercise.lines=10, exercise.setup="prepare-pipes"}
# view x

# use %>% to get the mean() of x

# use |> to get the mean() of x

# use %>% to get the mean() and round() the output to 1 digit

# use |> to get the mean() and round() the output to 1 digit

```


If you're using RStudio, you can set which pipe you'd like to use under **Tools** > **Global Options** > **Code**: *Use native pipe operator |> (requires R 4.1+*) 

```{r set-pipe, echo=FALSE, fig.align='center', out.height='80%', out.width='80%'}
knitr::include_graphics(path = "www/set-pipe.png")
```

## Summarise Cases  

## Group Cases 

## Manipulate Cases 

## Manipulate Variables  




